name: Notifikace novÃ½ch issues

on:
  issues:
    types: [opened]

jobs:
  notify:
    runs-on: ubuntu-latest
    # Pouze pro issues s labelem "bug-report"
    if: contains(github.event.issue.labels.*.name, 'bug-report')

    steps:
      - name: Check mail secrets
        id: mail_check
        env:
          MAIL_USERNAME: ${{ secrets.MAIL_USERNAME }}
          MAIL_PASSWORD: ${{ secrets.MAIL_PASSWORD }}
          NOTIFICATION_EMAIL: ${{ secrets.NOTIFICATION_EMAIL }}
        run: |
          if [ -n "$MAIL_USERNAME" ] && [ -n "$MAIL_PASSWORD" ] && [ -n "$NOTIFICATION_EMAIL" ]; then
            echo "enabled=true" >> "$GITHUB_OUTPUT"
          else
            echo "enabled=false" >> "$GITHUB_OUTPUT"
            echo "Mail secrets are not fully configured; skipping email send."
          fi

      - name: Poslat email notifikaci
        if: steps.mail_check.outputs.enabled == 'true'
        uses: dawidd6/action-send-mail@v3
        with:
          # SMTP server (pouÅ¾ij Gmail, Outlook, nebo vlastnÃ­ SMTP)
          server_address: smtp.gmail.com
          server_port: 587

          # PÅ™ihlaÅ¡ovacÃ­ Ãºdaje (uloÅ¾enÃ© v GitHub Secrets)
          username: ${{ secrets.MAIL_USERNAME }}
          password: ${{ secrets.MAIL_PASSWORD }}

          # Email detaily
          subject: "[Bug Report] NovÃ½ issue #${{ github.event.issue.number }}"
          to: ${{ secrets.NOTIFICATION_EMAIL }}
          from: ${{ secrets.MAIL_USERNAME }}

          # TÄ›lo emailu
          body: |
            ğŸ› NovÃ½ bug report byl nahlÃ¡Å¡en!

            **Issue:** #${{ github.event.issue.number }}
            **NÃ¡zev:** ${{ github.event.issue.title }}
            **Autor:** ${{ github.event.issue.user.login }}
            **VytvoÅ™eno:** ${{ github.event.issue.created_at }}

            **Obsah:**
            ${{ github.event.issue.body }}

            ---

            **Akce:**
            ğŸ”— Zobrazit issue: ${{ github.event.issue.html_url }}
            ğŸ”— OdpovÄ›dÄ›t: ${{ github.event.issue.html_url }}#new_comment_field

            ---

            Tento email byl automaticky vygenerovÃ¡n GitHub Actions.

          # HTML verze (volitelnÃ©)
          html_body: |
            <h2>ğŸ› NovÃ½ bug report</h2>
            <table>
              <tr><td><strong>Issue:</strong></td><td>#${{ github.event.issue.number }}</td></tr>
              <tr><td><strong>NÃ¡zev:</strong></td><td>${{ github.event.issue.title }}</td></tr>
              <tr><td><strong>Autor:</strong></td><td>${{ github.event.issue.user.login }}</td></tr>
            </table>

            <h3>Obsah:</h3>
            <pre>${{ github.event.issue.body }}</pre>

            <p>
              <a href="${{ github.event.issue.html_url }}" style="background: #0074e4; color: white; padding: 10px 20px; text-decoration: none; border-radius: 5px;">
                Zobrazit issue na GitHubu
              </a>
            </p>
